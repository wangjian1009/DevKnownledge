# RFC5389 - Session Traversal Utilities for NAT (STUN)
[TOC]

## 1.	简介
本说明书中说定义的协议—会话穿透NAT用法，为处理NAT提供了一种工具。它提供了一种为端点决定由NAT分配的和端点本身私有地址和端口相关联的IP地址和端口的方法。他也提供一种保持NAT绑定的方法。本协议的扩展可用于两端点的连接检测[MMUSIC-ICE]，或者两端点之间的包中转[BEHAVE-TURN].

为保持工具的特性，本说明书定义了一种可扩展的包格式，几种传输层协议之上的操作以及两种鉴权形式。

STUN被试图用于解决一种或者多种NAT穿透。这些解决方案即是为我们所知的STUN用法。每种用法描述了STUN怎样被用于实现NAT穿透解决方案。典型地，一种用法指明什么时候STUN消息被发送，哪种可选属性被包含，什么服务器被使用，以及什么鉴权方式被使用。交互式连接建立(ICE) [MMUSIC-ICE] 是STUN的一种使用方式. SIP Outbound[SIP-OUTBOUND]是另外的一种STUN用法。在某些情况下，一种用法需要扩展STUN，一种STUN扩展能以新的方法，属性，或者错误响应码的形式出现。更多的STUN用法信息能够在第14节找到。
   
## 2.	源于RFC3489的演变

STUN最初定义在RFC3489。RFC3489有时候被成为“经典的STUN”，它是以能完全解决NAT穿透问题的解决方案来描述的。在该解决方案中一个客户端能够发现它自己是否处在NAT的后面，判定NAT的类型，发现NAT外围的公网IP地址和端口，然后利用这个IP地址和端口填在协议体中，参见RFC3261。然而，自从RFC3489发布后，经验发现经典的STUN简直不能按一种分布式的解决方案来有效地工作。通过经典STUN获得的IP地址和端口有时候对端到端的通讯有用，但是有时候没有用。经典的STUN没有提供方法来是否应该发现，事实上，工作还是不工作，并且在它不能工作的情况下没有提供补救措施。更有甚者的是，经典STUN的判断NAT类型的分类算法被发现是不完美的，许多NAT不完全符合由它定义的类型。
经典STUN也存在一种安全弱点—攻击者能够在特定的拓扑和限制下提供错误的映射，这基本上不能通过加密方式来解决。尽管这个问题在本说明书中仍存在，但是通过使用STUN更完善的解决方案使得攻击被缓解了。
鉴于这些原因，本说明书淘汰了RFC3489，并且将STUN描述成一种工具用于完全穿透NAT解决方案的一部分。ICE [MMUSIC-ICE]是一种为像SIP那样基于offer/answer [RFC3264]策略的协议提供完全的解决方案。SIP Outbound [SIP-OUTBOUND]是一种sip信令完全穿透的解决方案，它以完全不同的方法使用STUN。因此，一个协议可能能够由它自己使用STUN作为一种解决方案，这类的用法没在这描述，由于上述原因它被强烈的阻止了。
这里描述的上了线的协议仅是轻微地改自经典STUN。运行在TCP和UDP之上的协议的扩展是一个更加结构化的方法。一个极其巧妙的让应用程序使用STUN的机制是偷用RFC3489中定义的128位事物ID中的32位，允许改变向后兼容。编码的地址映射使用一种新的异或格式。还有其他的，更小的改变，参见19节更加完整的描述。
由于使用范围的改变，STUN已经从"Simple Traversal of UDP through NAT"更名为 "Session Traversal Utilities for NAT"。略缩词仍为大家熟知的STUN。

## 3.	操作概览

本节仅是描述性的。

```txt
                               /-----\
                             // STUN  \\
                            |   Server  |
                             \\       //
                               \-----/

                          +--------------+             Public Internet
          ................|     NAT 2    |.......................
                          +--------------+

                          +--------------+             Private NET 2
          ................|     NAT 1    |.......................
                          +--------------+

                              /-----\
                            //  STUN \\
                           |    Client |
                            \\       //               Private NET 1
                              \-----/


               Figure 1: One Possible STUN Configuration
```


